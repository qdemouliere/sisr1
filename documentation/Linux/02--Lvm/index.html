
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://qdemouliere.github.io/sisr1/documentation/Linux/02--Lvm/">
      
      
        <link rel="prev" href="../01--Commandes/">
      
      
        <link rel="next" href="../03--Grub/">
      
      
        
      
      
      <link rel="icon" href="../../../media/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>LVM le gestionnaire de volumes logiques sous GNU/Linux - Documentation technique BTS SIO 1</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lvm-le-gestionnaire-de-volumes-logiques-sous-gnulinux" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="Documentation technique BTS SIO 1" class="md-header__button md-logo" aria-label="Documentation technique BTS SIO 1" data-md-component="logo">
      
  <img src="../../../media/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation technique BTS SIO 1
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LVM le gestionnaire de volumes logiques sous GNU/Linux
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Documentation technique BTS SIO 1" class="md-nav__button md-logo" aria-label="Documentation technique BTS SIO 1" data-md-component="logo">
      
  <img src="../../../media/logo.png" alt="logo">

    </a>
    Documentation technique BTS SIO 1
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bloc 2 - Exploitation des serveurs et des services SISR 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01--Commandes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mémo des commandes fondamentales sur Debian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    LVM le gestionnaire de volumes logiques sous GNU/Linux
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    LVM le gestionnaire de volumes logiques sous GNU/Linux
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-historique" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Historique
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-comment-fonctionne-lvm-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Comment fonctionne LVM 2 ?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-les-commandes-liees-a-lutilisation-de-lvm-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Les commandes liées à l'utilisation de LVM 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-les-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Les snapshots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03--Grub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sécuriser l'accès au logiciel d'amorçage GRUB 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-historique" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Historique
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-comment-fonctionne-lvm-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Comment fonctionne LVM 2 ?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-les-commandes-liees-a-lutilisation-de-lvm-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Les commandes liées à l'utilisation de LVM 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-les-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Les snapshots
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lvm-le-gestionnaire-de-volumes-logiques-sous-gnulinux">LVM le gestionnaire de volumes logiques sous GNU/Linux</h1>
<h2 id="1-introduction">1. Introduction</h2>
<p>La gestion des disques et de l'espace de stockage peut vite devenir un casse-tête sur un serveur notamment lorsque l'on se rend compte après coup que le partitionnement choisi sur le disque dur n'était pas pertinent ou que l'une des paritions est saturée.</p>
<p>Heureusement sur GNU/Linux, une solution géniale existe ! Elle se nomme <strong>Logical Volume Manager</strong> (LVM). Elle pourra vous sauver la mise dans bien des situations stressantes et compliquées.</p>
<h2 id="2-historique">2. Historique</h2>
<p>À la fin des années 1990, IBM a libéré le code source de son gestionnaire de volumes logiques (LVM) et de son système de fichiers journalisé (JFS) afin de les porter sur Linux. Cette initiative a permis d’intégrer LVM dans le noyau Linux, offrant ainsi une solution flexible pour la gestion des espaces de stockage, notamment la possibilité de redimensionner dynamiquement les partitions et de créer des volumes s’étendant sur plusieurs disques physiques. </p>
<p>Puis LVM 2 a été proposée et ajoute des fonctionnalités supplémentaires extrêmement puissantes telles que les snapshots et le thin provisioning (création de volumes n'utilisant que l'espace en cours d'utilisation, ex : un volume logique de 30 Go qui ne disposera que de 8Go d'espace utilisé aura une taille de 8 Go et pourra augmenter dynamiquement).</p>
<p>LVM 2 est un outil présent sur la majorité des distributions GNU/Linux modernes dont Debian.</p>
<h2 id="3-comment-fonctionne-lvm-2">3. Comment fonctionne LVM 2 ?</h2>
<p>Voici les éléments clés de l’architecture de LVM2 :</p>
<ul>
<li>
<p><strong>Physical Volumes (PV)</strong> : Ce sont les disques physiques ou partitions qui serviront de base pour LVM2. Ils peuvent être de différents types (HDD, SSD, etc.).</p>
</li>
<li>
<p><strong>Volume Groups (VG)</strong> : Un Volume Group regroupe plusieurs Physical Volumes en un seul espace logique. C’est une sorte de “pool” dans lequel on peut puiser pour créer des volumes logiques.</p>
</li>
<li>
<p><strong>Logical Volumes (LV)</strong> : Les Logical Volumes sont des morceaux du Volume Group. Ce sont eux que vous formatez et montez pour y stocker vos données. Ils fonctionnent comme des partitions, mais avec beaucoup plus de flexibilité.</p>
</li>
<li>
<p><strong>Thin Provisioning</strong> : C’est une fonctionnalité avancée qui permet de créer des volumes logiques sans allouer immédiatement tout l’espace. Pratique pour optimiser l’utilisation des ressources.</p>
</li>
<li>
<p><strong>Snapshots</strong> : Ce sont des copies instantanées d’un volume logique. Parfait pour sauvegarder ou tester des modifications.</p>
</li>
</ul>
<p>Voici un schéma de principe expliquant le fonctionnement de LVM 2 :</p>
<p><img alt="" src="../../../media/linux/lvm.png" /></p>
<h2 id="4-les-commandes-liees-a-lutilisation-de-lvm-2">4. Les commandes liées à l'utilisation de LVM 2</h2>
<p><strong>Installer LVM 2 sur Debian si nécessaire</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>lvm2
</span></code></pre></div>
<p><strong>Analyse des disques existants sur le système</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w"> </span>sudo<span class="w"> </span>lsblk
</span></code></pre></div>
<p>On peut également utiliser l'outil historique <em>fdisk</em>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>fdisk<span class="w"> </span>-l<span class="w"> </span>
</span></code></pre></div>
<p><strong>Convertir des disques ou des partitions en Physical Volumes (PV)</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sda<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span>Physical<span class="w"> </span>volume<span class="w"> </span><span class="s2">&quot;/dev/sda&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created.
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span>Physical<span class="w"> </span>volume<span class="w"> </span><span class="s2">&quot;/dev/sdb&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created.
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span>Physical<span class="w"> </span>volume<span class="w"> </span><span class="s2">&quot;/dev/sdc&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created.
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span>Physical<span class="w"> </span>volume<span class="w"> </span><span class="s2">&quot;/dev/sdd&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created.
</span></code></pre></div>
<p>Si l'on souhaite initialiser un seul disque ou une seule partition :</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>pvcreate<span class="w"> </span>sde
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>pvcreate<span class="w"> </span>sde1
</span></code></pre></div>
<p><strong>Obtenir les informations concernant les PVE</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>sudo<span class="w"> </span>pvdisplay
</span></code></pre></div>
<p><strong>Création d'un Volume Group (VG)</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>sudo<span class="w"> </span>vgcreate<span class="w"> </span>Data<span class="w"> </span>/dev/sda<span class="w"> </span>/dev/sdb<span class="w"> </span>/dev/sdc<span class="w"> </span>/dev/sdd
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span>Volume<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;Data&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created
</span></code></pre></div>
<p><strong>Obtenir les informations concernant les VG</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sudo<span class="w"> </span>vgdisplay
</span></code></pre></div>
<p><strong>Création de volumes logiques (LV)</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>250G<span class="w"> </span>-n<span class="w"> </span>MySQLData<span class="w"> </span>Data
</span></code></pre></div>
<p><strong>Obtenir les informations concernant les LV</strong> 
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>sudo<span class="w"> </span>lvdisplay
</span></code></pre></div></p>
<p><strong>Formatage des volumes logiques (LV)</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>/dev/Data/MySQLData
</span></code></pre></div>
<p><strong>Montage des volumes logiques sur le système</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/bdd
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/Data/MySQLData<span class="w"> </span>/bdd
</span></code></pre></div>
<p>Si vous souhaitez rendre les points de montage persistants (automatiquement montés au démarrage de l'OS), il est nécessaire d'ajouter une ligne spécifique dans le fichier /etc/fstab. </p>
<p>Pour vérifier si le montage est effectif, vous pouvez utiliser les commandes df ou mount.</p>
<p><strong>Augmentation de la taille d'un volume logique</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>sudo<span class="w"> </span>lvextend<span class="w"> </span>-L<span class="w"> </span>+20G<span class="w"> </span>/dev/Data/MySQLData
</span></code></pre></div>
<p>Après avoir agrandi le volume logique, il est nécessaire de redimensionner le système de fichier utilisé</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/Data/MySQLData
</span></code></pre></div>
<p><strong>Réduction de la taille d'un volume logique</strong></p>
<div class="admonition warning">
<p class="admonition-title">Attention</p>
<p>La réduction d'un volume logique n'est pas anodin et peut entrainer des problèmes dont la perte ou la corruption de données. Réalisez cette opération avec prudence.</p>
</div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>sudo<span class="w"> </span>resize2fs<span class="w"> </span>/dev/Data/MySQLData<span class="w"> </span>30G
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>sudo<span class="w"> </span>lvreduce<span class="w"> </span>-L<span class="w"> </span>30G<span class="w"> </span>/dev/Data/MySQLData
</span></code></pre></div>
<p><strong>Suppression d'un volume logique</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>sudo<span class="w"> </span>umount<span class="w"> </span>/bdd<span class="w"> </span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>sudo<span class="w"> </span>lvremove<span class="w"> </span>/dev/Data/MySQLData<span class="w"> </span>
</span></code></pre></div>
<p><strong>Suppression d'un groupe de volume</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>sudo<span class="w"> </span>lvremove<span class="w"> </span>/dev/Data
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>sudo<span class="w"> </span>vgremove<span class="w"> </span>Data
</span></code></pre></div>
<p><strong>Surveiller l'état des volumes</strong> </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>sudo<span class="w"> </span>lvscan
</span></code></pre></div>
<h2 id="5-les-snapshots">5. Les snapshots</h2>
<p>LVM permet de réaliser des clichés instantanés de volumes logiques (snapshots). Les snapshots sont des volumes logiques "spéciaux". Ce LV "snapshot" ne contient pas de système de fichiers et ne peut donc pas être monté. Il va stocker uniquement les modifications de données (ajout/suppressions). On définira une taille à ce volume logique de type snapshot, mais cette valeur n'agrandira pas le volume logique initial évidemment</p>
<p>Dans un premier temps, il faut s'assurer qu'il reste de la place dans le groupe de volume afin de pouvoir créer un nouveau volume logique dédié aux snpashots.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>sudo<span class="w"> </span>vgs
</span></code></pre></div>
<p>Il faut identifier ensuite le volume logique pour lequel on veut créer un instantané.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>sudo<span class="w"> </span>lvs<span class="w"> </span>
</span></code></pre></div>
<p><strong>Création du snapshot</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>sudo<span class="w"> </span>lvcreate<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>-s<span class="w"> </span>-n<span class="w"> </span>snapbdd<span class="w"> </span>/dev/Data/MySQLData
</span></code></pre></div>
<p>On va créer ici un nouveau volume logique de 10 Giga dédié aux snapshots de MySQLData. Les 10 Giga ne seront pas directement mobilisés. Au fur et à mesure des modifications dans MySQLData, <em>snpbdd</em> grossira et utilisera de plus en plus d'espace libre.</p>
<p>La taille va augmenter à chaque modification sur le système de fichier concerné : création, modification, suppression de fichiers. Il peut donc théoriquement avoir besoin de plus de place sur le LV "snapshot" que de place initiale sur le LV source. Il s'agit du même mécanisme que les snapshots de machine virtuelle.</p>
<p><strong>Restaurer un snapshot démontable</strong></p>
<p>Si l'on ne souhaite pas conserver les modifications réalisées après le snapshot, on va restaurer le volume logique dans son état antérieur.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>sudo<span class="w"> </span>umount<span class="w"> </span>/bdd<span class="w"> </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>sudo<span class="w"> </span>lvconvert<span class="w"> </span>--mergesnapshot<span class="w"> </span>/dev/Data/MySQLData
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>sudo<span class="w"> </span>mount<span class="w"> </span>/data<span class="w"> </span>
</span></code></pre></div>
<p><strong>Restaurer un snapshot non démontable</strong> </p>
<p>Dans le cas d'un snapshot de la racine par exemple, ou d'un volume utilisé par des processus qu'on ne peut stopper, on va lancer directement la commande lvconvert.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>sudo<span class="w"> </span>lvconvert<span class="w"> </span>--mergesnapshot<span class="w"> </span>/dev/Data/snapbdd
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>sudo<span class="w"> </span>shutdown<span class="w"> </span>-r<span class="w"> </span>shutdown
</span></code></pre></div>
<p>Pour prendre en compte la restauration, nous n'aurons pas d'autre choix que de redémarrer la machine.</p>
<p><strong>Fusionner le snapshot</strong> </p>
<p>Si après des modifications, on souhaite garder les données en l'état, on va supprimer le snapshot réalisé précédemment. Le LV d'origine et le LV snapshot seront fusionnés.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>sudo<span class="w"> </span>lvremove<span class="w"> </span>/dev/Data/snapbdd
</span></code></pre></div>
<h2 id="sources">Sources</h2>
<ul>
<li><a href="https://blog.stephane-robert.info/docs/admin-serveurs/linux/lvm/">La documentation sur LVM de Stéphane Robert</a> </li>
<li><a href="https://www.linuxtricks.fr/wiki/lvm-avance-les-snapshots">L'article sur les snapshots LVM d'Adrien Linux Tricks</a> </li>
<li><a href="https://www.it-connect.fr/gestion-des-lvm-sous-linux/">La documentation sur LVM d'IT Connect</a> </li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pied de page" >
        
          
          <a href="../01--Commandes/" class="md-footer__link md-footer__link--prev" aria-label="Précédent: Mémo des commandes fondamentales sur Debian">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Précédent
              </span>
              <div class="md-ellipsis">
                Mémo des commandes fondamentales sur Debian
              </div>
            </div>
          </a>
        
        
          
          <a href="../03--Grub/" class="md-footer__link md-footer__link--next" aria-label="Suivant: Sécuriser l&#39;accès au logiciel d&#39;amorçage GRUB 2">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Suivant
              </span>
              <div class="md-ellipsis">
                Sécuriser l'accès au logiciel d'amorçage GRUB 2
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Licence CC 4.0 FR BY-NC-SA - 2025 - Q. Demoulière - Lycée Paul-Louis Courier
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.footer", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>